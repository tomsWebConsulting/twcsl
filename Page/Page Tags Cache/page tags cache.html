<!-- begin TWC Page Tags Cache -->

  <script>
  
    ( ( ) => {
    
      /*
      
        page tags cache
        
        License       : < https://tinyurl.com/s872fb68 >
        
        Version       : 0.3.1
        
        SS Versions   : 7.1, 7.0
        
        v7.1
        Products V2
        Compatible    : Not Applicable
        
        v7.1
        Fluid
        Engine
        Compatible    : Not Applicable
        
        Notes         : the code makes a call to an unofficial Squarespace
                        GetCollectionTags API for information that is not
                        normally available through other means
                        
                        the cache disable option doesn't disable the overall
                        cache logic. it simply removes the session storage key
                        after user callbacks are run. this causes the cache data
                        to be regenerated when the Store page is reloaded
                        
                        this can be useful for testing or if you want site
                        visitors to always have access to the current tags
        
        Copyright     : 2025 Thomas Creedon
                        
                        Tom's Web Consulting < http://www.tomsWeb.consulting/ >
        
        no user serviceable parts below
        
        */
        
      const
      
        version = '0.3.1',
        
        s = `
        
          Page Tags Cache v${ version }
          
          License < https://tinyurl.com/s872fb68 >
          
          Â© 2025 Thomas Creedon
          
          Tom's Web Consulting < http://www.tomsWeb.consulting >
          
          `
          
          .replace ( /^\s+/gm, '' );
          
      console.log ( s );
      
      const
      
        isBlogPage
        
          =
          
          !!
          
          document
          
            .querySelectorAll (
            
              [
                  
                'body[ class*="collection-type-blog-" ]',
                
                'body[ class~="collection-type-blog" ]'
                
                ]
                
                .join ( ', ' )
                
              )
              
              .length,
              
        isEventsPage
        
          =
          
          !!
          
          document
          
            .querySelectorAll (
            
              [
                  
                'body[ class*="collection-type-events-" ]',
                
                'body[ class~="collection-type-events" ]'
                
                ]
                
                .join ( ', ' )
                
              )
              
              .length,
              
        isStorePage = Static
        
          .SQUARESPACE_CONTEXT
          
          .collection
          
          ?.type
          
          ===
          
          13,
          
        hasTags = isBlogPage || isEventsPage || isStorePage;
          
      if ( ! hasTags ) return; // bail if not has tags
      
      // globals
      
      {
      
        // initialize twc module
        
        window.twc = ( ( self ) => self ) ( window.twc || { } );
        
        // initialize twc ptc sub-module
        
        twc.ptc = ( ( self ) => self ) ( twc.ptc || { } );
        
        // initialize twc ptc callbacks sub-module
        
        twc.ptc.callbacks =
        
          ( ( self ) => self ) ( twc.ptc.callbacks || [ ] );
          
        }
        
      const
      
        codeKey = 'twc-ptc',
        
        dclCallback = async ( ) => {
        
          const
          
            hasCallbacks = options
            
              .callbacks
              
              .length;
              
          // bail if no callbacks
          
          if ( ! hasCallbacks ) {
          
            const s = `${ codeKey } no callbacks`;
            
            console.warn ( s );
            
            return;
            
            }
            
          let tags = sessionStorage
          
            .getItem ( codeKey );
            
          // bail if tags
          
          if ( tags ) {
          
            tags = JSON.parse ( tags );
            
            userCallbacks ( tags );
            
            if ( options.cacheDisable )
            
              sessionStorage
              
                .removeItem ( codeKey );
                
            return;
            
            }
            
          const url
          
            =
            
            '/api/commondata/GetCollectionTags?collectionId='
            
            +
            
            Static
            
              .SQUARESPACE_CONTEXT
              
              .collection
              
              .id;
              
          try {
          
            const response = await fetch ( url );
            
            if ( ! response.ok ) {
            
              const s = `
              
                ${ codeKey } network response was not ok ${
                
                  response.statusText
                  
                  }
                  
                `
                
                .trim ( )
                
                .replace ( /\s+/gm, ' ' );
                
              throw new Error ( s );
              
              }
              
            tags = await response.json ( );
            
            } catch ( error ) {
            
              const s = `
              
                ${ codeKey } there has been a problem with your fetch get
                
                operation, ${ error }.
                
                `
                
                .trim ( )
                
                .replace ( /\s+/gm, ' ' );
                
              console.error ( s );
              
              } finally {
              
                const callback = ( tag ) => {
                
                  tag
                  
                    .className
                    
                    =
                    
                    tagNameToCssClassName ( tag.name );
                    
                  tag
                  
                    .queryValue
                    
                    =
                    
                    tagNameToQueryValue ( tag.name );
                    
                  };
                  
                tags.forEach ( callback );
                
                sessionStorage.setItem (
                
                  codeKey,
                  
                  JSON
                  
                    .stringify ( tags )
                    
                  );
                  
                userCallbacks ( tags );
                
                if ( options.cacheDisable )
                
                  sessionStorage
                  
                    .removeItem ( codeKey );
                    
                }
                
          },
          
        options = codeKey
        
          .split ( '-' )
          
          .reduce ( ( obj, key ) => obj?.[ key ], window ),
          
        tagNameToCssClassName = ( name ) => {
        
          const className = 'tag-'
          
            +
            
            name
            
              .replaceAll ( ' ', '-' )
              
              .toLowerCase ( )
              
              .replace ( /[^\w-]+/g, '' )
              
              .replaceAll ( '--', '-' );
              
          return className;
          
          },
          
        tagNameToQueryValue = ( name ) => {
        
          const queryValue = name
          
            .replaceAll ( ' ', '-' )
            
            .replace ( /[^\w-]+/g, '' )
            
            .replaceAll ( '--', '-' );
            
          return queryValue;
          
          },
          
        userCallbacks = ( tags ) => {
        
          const callback = ( callback ) => {
          
            try {
            
              callback ( tags );
              
              } catch ( error ) {
              
                const s = `${ codeKey } callback error`;
                
                console.error ( s, error );
                
                }
                
            };
          
          options
          
            .callbacks
            
            .forEach ( callback );
            
          };
          
      document.addEventListener (
      
        'DOMContentLoaded',
        
        dclCallback
        
        );
        
      } ) ( );
      
    </script>
    
  <!-- end TWC Page Tags Cache -->
