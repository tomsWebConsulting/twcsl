<!-- begin TWC Store Page Tags Text Add -->

  <!--
  
    begin store page tags text add
    
    License       : < https://tinyurl.com/s872fb68 >
    
    Version       : 0.2.1
    
    SS Version    : 7.1
    
    Products V2
    Compatible    : Yes
    
    Fluid
    Engine
    Compatible    : Not Applicable
    
    Notes         : the code is comprised of a style and script tag. both are
                    needed for the full effect to work
                    
                    the code makes a call to the JSON version of the store page
                    for information that is not normally avaiable on the page
    
    Copyright     : 2023-2025 Thomas Creedon
                    
                    Tom's Web Consulting < http://www.tomsWeb.consulting/ >
    
    no user serviceable parts below
    
    -->
    
  <style>
  
    .twc-sptta {

      display : flex;
      flex-wrap : wrap;
      column-gap : 2em;
      list-style-position : inside;
      padding : 0;
      row-gap : 0;      
      white-space : nowrap;
      
      }
      
    .product-list .product-list-item .product-list-item-link .product-list-item-meta .twc-sptta {

      flex-direction : column;
      
      }
      
    </style>
    
  <script>
  
    ( ( ) => {
    
      const
      
        version = '0.2.1',
      
        s = `
        
          Store Page Tags Text Add v${ version }
          
          License < https://tinyurl.com/s872fb68 >
          
          Â© 2023-2025 Thomas Creedon
          
          Tom's Web Consulting < http://www.tomsWeb.consulting >
          
          `
          
          .replace ( /^\s+/gm, '' );
          
      console.log ( s );
      
      const isStorePage = Static
      
        .SQUARESPACE_CONTEXT
        
        .collection
        
        ?.type
        
        ===
        
        13;
        
      if ( ! isStorePage ) return; // bail if not store page
      
      const callback = async ( ) => {
      
        const
        
          callback = ( tag ) => {
          
            const
            
              re = new RegExp ( `${ codeKey } (.+) (ld|l|d)` ),
            
              m = tag.match ( re );
              
            if ( ! m ) return; // continue if tag doesn't match format
            
            const
            
              pageShow = m [ 2 ],
              
              b
              
                =
                
                isList && pageShow === 'd'
                
                ||
                
                isDetail && pageShow === 'l';
                
            if ( b ) return; // continue
            
            const
            
              callback = ( element ) => {
              
                let
                
                  selector,
                  
                  url = new URLSearchParams (
                  
                    new URL (
                    
                      `http://twc.sptta${
                      
                        fullUrl
                        
                        }`
                        
                      )
                      
                      .search
                      
                    );
                    
                switch ( true ) {
                
                  case isDetail :
                  
                    selector = '.product-detail .product-meta';
                      
                    break;
                    
                  case isList :
                  
                    selector
                    
                      =
                      
                      '.product-list .product-list-item '
                      
                      +
                      
                      '.product-list-item-link .product-list-item-meta';
                      
                    break;
                    
                  }
                  
                url
                
                  .append ( 'tag', tag );
                  
                url = `${ fullUrl }?${ url }`;
                
                const wrapperElement = element
                
                  .querySelector ( selector );
                  
                let ulElement = wrapperElement
                
                  .querySelector ( `.${ codeKey }` );
                  
                if ( ! ulElement ) {
                
                  ulElement = document
                  
                    .createElement ( 'template' );
                    
                  ulElement
                  
                    .innerHTML
                    
                    =
                    
                    `
                    
                      <ul class="${ codeKey }">
                      
                        </ul>
                        
                      `;
                      
                  ulElement = ulElement
                  
                    .content
                    
                    .firstElementChild;
                    
                  wrapperElement
                  
                    .append ( ulElement );
                    
                  }
                  
                ulElement
                
                  .insertAdjacentHTML (
                  
                    'beforeend',
                    
                    `
                    
                      <li data-tag-text="${ text }">
                      
                        <a href="${ url }">
                        
                          ${ text }
                          
                          </a>
                          
                        </li>
                        
                      `
                      
                    );
                    
                },
                
              text = m [ 1 ],
              
              className =
              
                tagNameToCssClassName ( m [ 0 ] ),
                
              selector = `.${ className }`;
              
            document
            
              .body
              
              .querySelectorAll ( selector )
              
              .forEach ( callback );
              
            },
            
          codeKey = 'twc-sptta',
          
          isDetail = ( ( ) => {
          
            const
            
              selector = 'body[ id^="item-" ]',
              
              is = document
              
                .querySelector ( selector )
                
                !==
                
                null;
                
            return is;
            
            } ) ( ),
            
          isList = ( ( ) => {
          
            const
            
              selector = 'body[ id^="collection-" ]',
              
              is = document
              
                .querySelector ( selector )
                
                !==
                
                null;
                
            return is;
            
            } ) ( ),
            
          fullUrl = Static
          
            .SQUARESPACE_CONTEXT
            
            .collection
            
            .fullUrl,
            
          tagNameToCssClassName = ( name ) => {
          
            const className = 'tag-'
            
              +
              
              name
              
                .replaceAll ( ' ', '-' )
                
                .toLowerCase ( )
                
                .replace ( /[^\w-]+/g, '' )
                
                .replaceAll ( '--', '-' );
                
            return className;
            
            },
            
          url = `${ fullUrl }?format=json`;
            
        try {
        
          const response = await fetch ( url );
          
          if ( ! response.ok ) {
          
            const s = `
            
              ${ codeKey } network response was not ok ${
              
                response
                
                  .statusText
                  
                  }
                  
              `
              
              .trim ( )
              
              .replace ( /\s+/gm, ' ' );
              
            throw new Error ( s );
            
            }
            
          const obj = await response.json ( );
          
          obj
          
            .collection
            
            .tags
            
            .filter ( t => t.startsWith ( `${ codeKey } ` ) )
            
            .forEach ( callback );
            
          } catch ( error ) {
          
            const s = `
            
              ${ codeKey } there has been a problem with your fetch get operation,
              
              ${ error }.
              
              `
              
              .trim ( )
              
              .replace ( /\s+/gm, ' ' );
              
            console.error ( s );
            
            }
            
        };
        
      document
      
        .addEventListener ( 'DOMContentLoaded', callback );
        
      } ) ( );
      
    </script>
    
  <!-- end TWC Store Page Tags Text Add -->
