<!-- begin TWC Store Page Detail Product Dimensions -->

  <!--
  
    store page detail product dimensions
    
    License       : < https://tinyurl.com/s872fb68 >
    
    Version       : 0.5.0
    
    SS Version    : 7.1
    
    Notes         : the code is comprised of several tags. all are needed for the
                    full effect to work
                    
                    this effect only considers the first variants dimensions. in
                    other words it doesn't work with products that have more than
                    one variant
                    
                    the dimensions entered in the squarespace editor are shipping
                    dimensions, not product dimensions. if you don't need to use
                    shipping dimensions for shipping you can use it for product
                    dimensions. if you need product dimensions as well as shipping
                    then use the <script type="application/vnd.twc.spdpd"> tag
                    referenced in the read me
    
    Copyright     : 2022-2025 Thomas Creedon
                    
                    Tom's Web Consulting < http://www.tomsWeb.consulting/ >
    
    no user serviceable parts below
    
    -->
    
  <style>
  
    body:not( .sqs-is-page-editing ) .product-description,
    body:not( .sqs-is-page-editing ) .sqs-html-content
    
      {
      
        visibility : hidden;
        
        }
        
    body:not( .sqs-is-page-editing ) .twc-spdpd-show .product-description,
    body:not( .sqs-is-page-editing ) .sqs-html-content
    
      {
      
        visibility : visible;
        
        }
        
    body:not( .sqs-is-page-editing ) em.twc-spdpd,
    body:not( .sqs-is-page-editing ) strong.twc-spdpd,
    body:not( .sqs-is-page-editing ) u.twc-spdpd
    
      {
      
        white-space-collapse : collapse;
        
        }
        
    body:not( .sqs-is-page-editing ) p.twc-spdpd {
    
      white-space-collapse : collapse !important;
      
      }
      
    </style>
    
  <script>
  
    ( ( ) => {
    
      const
      
        version = '0.5.0',
        
        s = `
        
          Store Page Detail Product Dimensions v${ version }
          
          License < https://tinyurl.com/s872fb68 >
          
          Â© 2022-2025 Thomas Creedon
          
          Tom's Web Consulting < http://www.tomsWeb.consulting >
          
          `
          
          .replace ( /^\s+/gm, '' );
          
      console.log ( s );
      
      const callback = ( ) => {
      
        const isStorePage = Static
        
          .SQUARESPACE_CONTEXT
          
          .collection
          
          .type
          
          ===
          
          13;
          
        if ( ! isStorePage ) return; // bail if not store page
        
        const isDetail = ( ( ) => {
        
          const selector = 'body[ id^="item-" ]';
          
          const is = document
          
            .querySelector ( selector )
            
            !==
            
            null;
            
          return is;
          
          } ) ( );
          
        if ( ! isDetail ) return; // bail if not detail
        
        const
        
          codeKey = 'twc-spdpd',
          
          convertUnitCallbacks = {
          
            CENTIMETER : {
            
              Cm : ( cm ) => cm,
              
              In : ( cm ) => cm / 2.54,
              
              Mm : ( cm ) => cm * 10
              
              },
              
            INCH : {
            
              Cm : ( inch ) => inch * 2.54,
              
              In : ( inch ) => inch,
              
              Mm : ( inch ) => inch / 0.039370
              
              },
              
            KILOGRAM : {
            
              Kg : ( kg ) => kg,
              
              Lb : ( lb ) => lb * 0.453592
              
              },
              
            POUND : {
            
              Kg : ( kg ) => kg * 2.20462,
              
              Lb : ( lb ) => lb
              
              }
              
            },
            
          hlwMap = {
          
            h : 'height',
            
            l : 'length',
            
            w : 'width'
            
            },
            
          nodeHtmlMap = [ ],
          
          options = codeKey
          
            .split ( '-' )
            
            .reduce ( ( obj, key ) => obj?.[ key ], window ),
            
          re = new RegExp ( `\\[${ codeKey }\\]`, 'gm' ),
          
          replaceTextNodeWithHTML = ( node, html ) => {
          
            const
            
              element = document
              
                .createElement ( 'div' ),
                
              fragment = document
              
                .createDocumentFragment ( );
                
            element.innerHTML = html;
            
            while ( element.firstChild )
            
              fragment
              
                .appendChild ( element.firstChild );
                
            node
            
              .parentNode
              
              .replaceChild ( fragment, node );
              
            },
            
          shippingSize = Static
          
            .SQUARESPACE_CONTEXT
            
            .product
            
            .variants [ 0 ]
            
            .shippingSize,
            
          shippingWeight = Static
          
            .SQUARESPACE_CONTEXT
            
            .product
            
            .variants [ 0 ]
            
            .shippingWeight,
            
          dimensions
          
            =
          
            options.dimensions
            
            ||
            
            {
            
              height : shippingSize.height,
              
              length : shippingSize.len,
              
              weight : shippingWeight.value,
              
              width : shippingSize.width
              
              };
              
        let
        
          callback = ( m ) => {
          
            const
            
              decimalPlaces = m [ 2 ],
              
              newUnit = m [ 3 ];
              
            let r,
            
              unit;
            
            switch ( m [ 1 ] ) {
            
              case 'h' :
              case 'l' :
              case 'w' :
              
                r = dimensions [
                
                  hlwMap [
                  
                    m [ 1 ]
                    
                    ]
                    
                  ];
                  
                unit = shippingSize.unit;
                  
                break;
                
              case 'k' :
              case 'p' :
              
                r = dimensions.weight
                  
                unit = shippingWeight.unit;
                
                break;
                
              }
              
            r = convertUnitCallbacks
            
              [ unit ]
              
              [ newUnit ]
              
              ( r )
              
              .toFixed ( decimalPlaces );
              
            format = format
            
              .replaceAll ( m [ 0 ], r );
              
            },
            
          format = options.format,
          
          selector = [
          
            '.product-description',
            
            '.sqs-block-html .sqs-block-content'
            
            ]
            
            .join ( ', ' );
            
        const matches = [
        
          ...
          
          format
          
            .matchAll ( /%([hklpw])(\d)(Cm|In|Kg|Lb|Mm)/g )
            
          ];
          
        matches.forEach ( callback );
        
        callback = ( element ) => {
        
          const walker =
          
            document.createTreeWalker ( element, NodeFilter.SHOW_TEXT );
            
          while ( walker.nextNode ( ) ) {
          
            const
            
              node = walker.currentNode,
              
              html = node
              
                .data
                
                .replace ( re, format );
                
            if ( html === node.data ) continue;
            
            nodeHtmlMap.push ( [ node, html ] );
            
            }
            
          };
          
        [
        
          ...
          
          document
          
            .body
            
            .querySelectorAll ( selector )
            
          ]
          
          .filter (
          
            e => e
            
              .textContent
              
              .includes ( `[${ codeKey }]` )
              
            )
            
          .forEach ( callback );
          
        callback = ( [ node, html ] ) => {
        
          node
          
            .parentElement
            
            .classList
            
            .add ( codeKey );
            
          replaceTextNodeWithHTML (
          
            node,
          
            html
            
            );
            
          };
          
        nodeHtmlMap.forEach ( callback );
        
        // meta elements clean
        
        {
        
          const attribute= 'content';
          
          callback = ( element ) => {
          
            const content = element
            
              .getAttribute ( attribute )
              
              .replace ( re, '' );
              
            element
            
              .setAttribute ( attribute, content );
              
            };
            
          selector
          
            =
            
            'meta'
            
            +
            
            [
            
              '[ property="og:description" ]',
              
              '[ itemprop="description" ]',
              
              '[ name="twitter:description" ]',
              
              '[ name="description" ]'
              
              ]
              
              .join ( ', meta' );
              
          document
          
            .head
            
            .querySelectorAll ( selector )
          
            .forEach ( callback );
            
          }
          
        // script element clean
        
        {
        
          callback = ( element ) => {
          
            const html = element
            
              .innerHTML
              
              .replace ( re, '' );
              
            element
            
              .innerHTML
              
              =
              
              html;
              
            };
            
          selector
          
            =
            
            'script[ type="application/ld+json" ]';
            
          [
          
            ...
            
            document
            
              .head
              
              .querySelectorAll ( selector )
              
            ]
            
            .filter (
            
              e => e.textContent.includes ( `[${ codeKey }]` )
              
              )
              
            .forEach ( callback );
            
          }
          
        document
        
          .body
          
          .querySelector ( '.product-detail' )
          
          .classList
          
          .add ( `${ codeKey }-show` );
          
        };
        
      document
      
        .addEventListener ( 'DOMContentLoaded', callback );
        
      } ) ( );
      
    </script>
    
  <!-- end TWC Store Page Detail Product Dimensions -->
