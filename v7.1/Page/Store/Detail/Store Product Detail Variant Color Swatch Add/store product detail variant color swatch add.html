<!-- begin TWC Store Product Detail Variant Color Swatch Add -->

  <!--
  
    store product detail variant color swatch add
    
    License       : < https://tinyurl.com/s872fb68 >
    
    Version       : 0.2.0
    
    SS Version    : 7.1
    
    Products V2
    Compatible    : Yes
    
    Fluid
    Engine
    Compatible    : Not Applicable
    
    Copyright     : 2023-2025 Thomas Creedon
                    
                    Tom's Web Consulting < http://www.tomsWeb.consulting/ >
    
    no user serviceable parts below
    
    -->
    
  <style>
  
    .product-detail .product-meta .product-variants {
    
      --twc-product-variants : hidden;
      
      visibility : var( --twc-product-variants );
      
      }
      
    .product-detail .product-meta .product-variants .variant-radiobtn-wrapper label {
    
      display : flex;
      gap : 1em;
      
      }
      
    .product-detail .product-meta .product-variants .variant-radiobtn-wrapper label span:first-child {
    
      border : 1px solid var( --twc-spdvcsa-border-color );
      width : 50px;
      
      }
      
    </style>
    
  <script>
  
    ( ( ) => {
    
      const callback = ( ) => {
      
        const
        
          version = '0.2.0',
          
          s = `
          
            Store Product Detail Variant Color Swatch Add v${ version }
            
            License < https://tinyurl.com/s872fb68 >
            
            Â© 2023-2025 Thomas Creedon
            
            Tom's Web Consulting < http://www.tomsWeb.consulting >
            
            `
            
            .replace ( /^\s+/gm, '' );
            
        console.log ( s );
        
        const isStorePage = Static
        
          .SQUARESPACE_CONTEXT
          
          .collection
          
          .type
          
          ===
          
          13;
          
        if ( ! isStorePage ) return; // bail if not store page
        
        const isDetail = ( ( ) => {
        
          const is = Static
          
            .SQUARESPACE_CONTEXT
            
            .item;
            
          return is;
          
          } ) ( );
          
        if ( ! isDetail ) return; // bail if not detail
        
        const
        
          codeKey = 'twc-spdvcsa',
          
          selectorKey = '.product-detail .product-meta .product-variants';
          
        // hide show register
        
        {
        
          // initialize twc data sub-module
          
          twc.data = ( ( self ) => self ) ( twc.data || { } );
          
          // initialize twc data hideShow sub-module
          
          twc.data.hideShow = ( ( self ) => self ) ( twc.data.hideShow || { } );
          
          // initialize twc data hideShow selector key sub-module
          
          twc.data.hideShow [ selectorKey ] = ( ( self ) => self ) (
          
            twc.data.hideShow [ selectorKey ] || [ ] );
            
          twc
          
            .data
            
            .hideShow
            
            [ selectorKey ]
            
            .push ( `--${ codeKey }` );
            
          }
          
        {
        
          let optionElement = document
          
            .body
            
            .querySelector ( selectorKey );
            
          const
          
            options = codeKey
            
              .split ( '-' )
              
              .reduce ( ( obj, key ) => obj?.[ key ], window ),
              
            xPathEvaluate = ( xPathExpression, contextNode ) => {
            
              const xPathResults = document
              
                .evaluate (
                
                  xPathExpression,
                  
                  contextNode,
                  
                  null,
                  
                  XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,
                  
                  null
                  
                  );
                  
              return xPathResults;
              
              },
              
            xPathExpression = `
            
              .//div [
              
                contains (
                
                  concat (
                  
                    ' ',
                    
                    normalize-space ( @class ),
                    
                    ' '
                    
                    ),
                  
                  ' variant-option-title '
                  
                  )
                  
                and
                
                contains (
                
                  .,
                  
                  '${ options.option }:'
                  
                  )
                  
                ]
                              
              `,
              
            xPathResults = xPathEvaluate (
            
              xPathExpression,
              
              optionElement
              
              );
              
          // bail if no element
          
          if ( ! xPathResults.snapshotLength ) return;
          
          const
          
            wrapInner = ( element, tag ) => {
            
              const innerWrapperElement = document
              
                .createElement ( tag );
                
              while ( element.firstChild ) {
              
                innerWrapperElement
                
                  .appendChild ( element.firstChild );
                  
                }
                
              element
              
                .appendChild ( innerWrapperElement );
                
              },
              
            colorMap = options.colorMap,
            
            option = options.option;
            
          optionElement
          
            =
            
            xPathResults
            
              .snapshotItem ( 0 )
              
              .parentElement;
              
          optionElement
          
            .classList
            
            .add ( codeKey );
            
          const selectElement = optionElement
          
            .querySelector ( '.variant-select-wrapper' );
            
          if ( selectElement ) {
          
            const callback = ( element ) => {
            
              const
              
                optionElement = document
                
                  .createElement ( 'template' ),
                  
                value = element
                
                  .textContent
                  
                  .trim ( );
                  
              optionElement
              
                .innerHTML
                
                =
                
                `
                
                  <input type="radio" class="variant-radiobtn" value="${ value }" name="variant-option-${ option }" id="variant-option-${ option }-${ value }">
                  
                  <label class="sqs-button-element--secondary" role="button" tabindex="0" for="variant-option-${ option }-${ value }">
                  
                    ${ value }
                    
                    </label>
                    
                  `;
                  
              wrapperElement
              
                .appendChild (
                
                  optionElement
                  
                    .content
                    
                  );
                  
              };
              
            let wrapperElement = document
            
              .createElement ( 'template' );
              
            // wrapper element
            
            {
            
              wrapperElement
              
                .innerHTML
                
                =
                
                `
                
                  <div class="variant-radiobtn-wrapper">
                    
                    </div>
                  
                  `;
                  
              wrapperElement = wrapperElement
              
                .content
                
                .firstElementChild;
                
              }
              
            [
            
              ...
              
              selectElement
              
                .querySelectorAll ( 'option' )
                
              ]
              
              .slice ( 1 )
              
              .forEach ( callback );
               
            selectElement
            
              .after ( wrapperElement );
              
            selectElement
            
              .remove ( );
              
            }
            
          for ( let [ key, value ] of Object.entries ( colorMap ) ) {
          
            const
            
              selector =
              
                `[ for="variant-option-${ option }-${ key }" ]`,
                
              element = optionElement
              
                .querySelector ( selector ),
                
              spanElement = document
              
                .createElement ( 'span' );
                
            let property;
            
            switch ( value ) {
            
              case 'slash' :
              
                property = 'background';
                
                value = 'linear-gradient( to top right, '
                
                  +
                
                  'rgba( 0, 0, 0, 0 ) 0%, '
                  
                  +
                
                  'rgba( 0, 0, 0, 0 ) calc( 50% - 1px ), '
                  
                  +
                  
                  'rgba( 191, 191, 191, 1 ) 50%, rgba( 0, 0, 0, 0 ) '
                  
                  +
                  
                  'calc( 50% + 1px ), rgba( 0, 0, 0, 0 ) 100% )';
                  
                break;
                
              default :
              
                property = 'background-color';
                
                break;
                
              }
              
            spanElement
            
              .style
              
              .setProperty ( property, value );
              
            wrapInner ( element, 'span' );
            
            element
            
              .insertBefore (
              
                spanElement,
                
                element
                
                  .firstChild
                  
                );
                
            }
            
          }
          
        // hide show unregister
        
        {
        
          twc
          
            .data
            
            .hideShow
            
            [ selectorKey ]
            
            .pop ( `--${ codeKey }` );
            
          const l = twc
          
            .data
            
            .hideShow
            
            [ selectorKey ]
            
            .length;
            
          if ( ! l )
          
            document
            
              .querySelector ( selectorKey )
              
              .style
              
              .setProperty ( '--twc-product-variants', 'unset' );
              
          }
          
        };
        
      document
      
        .addEventListener ( 'DOMContentLoaded', callback );
        
      } ) ( );
      
    </script>
    
  <!-- end TWC Store Product Detail Variant Color Swatch Add -->
