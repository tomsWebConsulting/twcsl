<!-- begin TWC Product Quick View Observe Changes -->

  <!--
  
    product quick view observe changes
    
    License       : < https://tinyurl.com/s872fb68 >
    
    Version       : 0.2.0
    
    SS Versions   : 7.1, 7.0
    
    v7.1
    Products V2
    Compatible    : Yes
    
    v7.1
    Fluid
    Engine
    Compatible    : Not Applicable
    
    Dependencies  : modal lightbox observe changes
                    
                    < https://tinyurl.com/2pfvaeud >
    
    Note          : this code is a base for other effects. on its own it doesn't
                    do anything. this code is not the end all be all of mutation
                    observers. it may not cover your needs
    
    Copyright     : 2024-2025 Thomas Creedon
                    
                    Tom's Web Consulting < http://www.tomsWeb.consulting/ >
    
    no user serviceable parts below
    
    -->
    
  <script>
  
    ( ( ) => {
    
      const
      
        version = '0.2.0',
        
        s = `Product Quick View Observe Changes v${ version }
        
          License < https://tinyurl.com/s872fb68 >
          
          Â© 2024-2025 Thomas Creedon
          
          Tom's Web Consulting < http://www.tomsWeb.consulting >`
          
          .replace ( /^\s+/gm, '' );
          
      console.log ( s );
      
      // globals
      
      {
      
        // initialize twc module
        
        window.twc = ( ( self ) => self ) ( window.twc || { } );
        
        // initialize twc pqvoc sub-module
        
        twc.pqvoc = ( ( self ) => self ) ( twc.pqvoc || { } );
        
        // initialize twc pqvoc callbacks sub-module
        
        twc.pqvoc.callbacks =
        
          ( ( self ) => self ) ( twc.pqvoc.callbacks || [ ] );
          
        }
        
      } ) ( );
      
    var twcPqvoc = ( node ) => {
    
      const isQuickView = node
      
        .classList
        
        .contains ( 'sqs-product-quick-view-lightbox' );
        
      if ( ! isQuickView ) return; // bail if no product quick view
      
      const
      
        callback = ( mutations ) => {
        
          const callback = ( mutation ) => {
          
            let hasAdded = mutation.addedNodes.length;
            
            if ( ! hasAdded ) return; // continue
            
            const
            
              element = mutation
              
                .addedNodes
                
                [ 0 ],
                
              isProduct = [
              
                'product-detail', // 7.1
                
                'ProductItem' // 7.0
                
                ]
                
                .some ( c => element.classList.contains ( c ) );
                
            if ( ! isProduct ) return; // bail if not product item
            
            const callback = ( callback ) => {
            
              try {
              
                callback = window [ callback ];
                
                callback ( element );
                
                } catch ( error ) {
                
                  const s = `${ codeKey } callback error`;
                  
                  console.error ( s, error );
                  
                  }
                  
              };
              
            options
            
              .callbacks
              
              .forEach ( callback );
              
            };
            
          mutations.forEach ( callback );
          
          },
          
        codeKey = 'twc-pqvoc',
        
        config = {
        
          childList : true
          
          },
          
        observer = new MutationObserver ( callback ),
        
        options = codeKey
        
          .split ( '-' )
          
          .reduce ( ( obj, key ) => obj?.[ key ], window ),
          
        selector = '.sqs-product-quick-view-content',
        
        element = node
        
          .querySelector ( selector );
          
      // start listening for changes in element
      
      observer.observe ( element, config );
      
      };
      
    </script>
    
  <!-- end TWC Product Quick View Observe Changes -->
