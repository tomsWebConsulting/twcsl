<!-- begin TWC Product Quick View Observe Changes -->

  <!--
  
    product quick view observe changes
    
    License           : < https://tinyurl.com/s872fb68 >
    
    Version           : 0.3.0
    
    SS Versions       : 7.1, 7.0
    
    v7.1
    Products V2
    Compatible        : Yes
    
    v7.1
    Fluid
    Engine
    Compatible        : Not Applicable
    
    Dependencies      : modal lightbox observe changes
                        
                        < https://tinyurl.com/2pfvaeud >
    
    Note              : this code is a base for other effects. on its own it
                        doesn't do anything. this code is not the end all be
                        all of mutation observers. it may not cover your needs
    
    Copyright         : 2024-2026 Thomas Creedon
                        
                        Tom's Web Consulting < http://www.tomsWeb.consulting/ >
    
    no user serviceable parts below
    
    -->
    
  <script>
  
    ( ( ) => {
    
      const
      
        version = '0.3.0',
        
        s = `Product Quick View Observe Changes v${ version }
        
          License < https://tinyurl.com/s872fb68 >
          
          Â© 2024-2026 Thomas Creedon
          
          Tom's Web Consulting < http://www.tomsWeb.consulting >`
          
          .replace ( /^\s+/gm, '' );
          
      console.log ( s );
      
      // initialize twc module
      
      window.twc = ( ( self ) => self ) ( window.twc || { } );
      
      // initialize twc pqvoc sub-module
      
      twc.pqvoc = ( ( self ) => self ) ( twc.pqvoc || { } );
      
      // initialize twc pqvoc callbacks sub-module
      
      twc.pqvoc.callbacks =
      
        ( ( self ) => self ) ( twc.pqvoc.callbacks || [ ] );
        
      // initialize twc mloc sub-module
      
      twc.mloc = ( ( self ) => self ) ( twc.mloc || { } );
      
      // initialize twc mloc callbacks sub-module
      
      twc.mloc.callbacks = ( ( self ) => {
      
        const callback = ( element ) => {
        
          const isQuickView = element
          
            .classList
            
            .contains ( 'sqs-product-quick-view-lightbox' );
            
          if ( ! isQuickView ) return; // bail if no product quick view
          
          const
          
            codeKey = 'twc-pqvoc',
            
            mutationCallback = ( mutation ) => {
            
              const hasAdded = mutation
              
                .addedNodes
                
                .length;
                
              if ( ! hasAdded ) return; // continue
              
              const
              
                element = mutation
                
                  .addedNodes
                  
                  [ 0 ],
                  
                isProduct = [
                
                  'product-detail', // 7.1
                  
                  'ProductItem' // 7.0
                  
                  ]
                  
                  .some (
                  
                    c => element
                    
                      .classList
                      
                      .contains ( c )
                      
                    );
                    
              if ( ! isProduct ) return; // bail if not product item
              
              options
              
                .callbacks
                
                .forEach ( runCallback );
                
              },
              
            mutationsCallback = ( mutations ) => {
            
              mutations.forEach ( mutationCallback );
              
              },
              
            observer = new MutationObserver (
            
              mutationsCallback
              
              ),
              
            options = codeKey
            
              .split ( '-' )
              
              .reduce ( ( obj, key ) => obj?.[ key ], window ),
              
            runCallback = ( callback ) => {
            
              try {
              
                callback = window [ callback ];
                
                callback ( element );
                
                } catch ( error ) {
                
                  const s = `${ codeKey } callback error`;
                  
                  console.error ( s, error );
                  
                  }
                  
              },
              
            selector =
            
              '.sqs-product-quick-view-content';
              
          // start listening for changes in element
          
          observer.observe (
          
            element
            
              .querySelector ( selector ),
            
            { childList : true }
            
            );
            
          };
          
        self.push ( callback );
        
        return self;
        
        } ) ( twc.mloc.callbacks || [ ] );
        
      } ) ( );
      
    </script>
    
  <!-- end TWC Product Quick View Observe Changes -->
