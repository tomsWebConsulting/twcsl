<!-- begin TWC Product Custom Form Text Field Max Length -->

  <!--
  
    product custom form text field max length
    
    License           : < https://tinyurl.com/s872fb68 >
    
    Version           : 0.3.1
    
    SS Versions       : 7.1, 7.0
    
    v7.1
    Fluid
    Engine
    Compatible        : Not Applicable
    
    v7.0 
    Templates         : Brine ( Aria, Blend, Burke, Cacao, Clay, Fairfield,
                        Feed, Foster, Greenwich, Hatch, Heights, Hunter, Hyde,
                        Impact, Jaunt, Juke, Keene, Kin, Lincoln, Maple, Margot,
                        Marta, Mentor, Mercer, Miller, Mojave, Moksha, Motto,
                        Nueva, Pedro, Pursuit, Rally, Rover, Royce, Sofia,
                        Sonora, Stella, Thorne, Vow, Wav, West )
                        
                        your template is not listed? then it is not currently
                        supported
    
    Dependencies      : form inner wrapper observe changes
                        
                        < https://tinyurl.com/yjbszby7 >
    
                      : modal lightbox observe changes
                        
                        < https://tinyurl.com/877wczvk >
    
    Notes             : this code does not work on the checkout page. it is a
                        Squarespace security feature that no code can alter the
                        checkout page
                        
                        this code is client side and making use of an HTML form
                        feature. Since this code is client side it is possible
                        to bypass the max length limit this code is setting. in
                        other words you still need to be checking manually when
                        forms or orders come in to make sure your limits are not
                        being exceeded. consider this code more of an aid to
                        help users not exceed your field max length limits
    
    Copyright         : 2024-2026 Thomas Creedon
                        
                        Tom's Web Consulting < http://www.tomsWeb.consulting/ >
    
    no user serviceable parts below
    
    -->
    
  <style>
  
    input[ placeholder*="ftfml" ] {
    
      visibility : hidden;
      
      }
      
    </style>
    
  <script>
  
    ( ( ) => {
    
      const
      
        version = '0.3.1',
        
        s = `Product Custom Form Text Field Max Length v${ version }
        
          License < https://tinyurl.com/s872fb68 >
          
          Â© 2024-2026 Thomas Creedon
          
          Tom's Web Consulting < http://www.tomsWeb.consulting >`
          
          .replace ( /^\s+/gm, '' );
          
      console.log ( s );
      
      const elementCallback = ( element ) => {
      
        debugger;
        
        const
        
          codeKey = `twc-pcftfml`,
          
          selector = 'input[ placeholder*="ftfml" ]',
          
          elements = element
          
            .querySelectorAll ( selector );
            
        if ( ! elements.length ) return; // bail if no elements
        
        // const callback = ( ) => {
        
          const callback = ( element ) => {
          
            const
            
              attribute = 'placeholder',
              
              re = /^ftfml\s*:\s*{([^}]+)}\s*/;
            
            let
            
              text = element
              
                .getAttribute ( attribute ),
                
              m = text.match ( re );
              
            // clean up placeholder attribute value
            
            {
            
              text = text
              
                .replace ( m [ 0 ], '' )
                
                .trim ( );
                
              if ( text ) // set/show placeholder or remove
              
                element
                
                  .setAttribute ( attribute, text );
                  
                else
                
                  element.removeAttribute ( attribute );
                  
              }
              
            let maxLength = m [ 1 ].trim ( );
            
            if ( isNaN ( maxLength ) ) {
            
              const callback = ( key ) => {
              
                const b = ! twc
                
                  .ftfmld
                  
                  .ids
                  
                  .includes ( key );
                  
                if ( b ) return; // bail if no key
                
                maxLength = idMaxlengthMap [ key ];
                
                };
                
              const
              
                json = '{' +
                
                  maxLength
                  
                    .replace ( /[\s]/g, '' )
                    
                    .split ( ',' )
                    
                    .map ( s => s.replace ( /([^:]+)/, '"$1"' ) )
                    
                    .join ( ',' ) +
                    
                  '}',
                  
                key = 'default',
                
                idMaxlengthMap = JSON.parse ( json );
                
              maxLength = '';
              
              if ( key in idMaxlengthMap )
              
                maxLength = idMaxlengthMap [ key ];
                
              Object
              
                .keys ( idMaxlengthMap )
                
                .forEach ( callback );
                
              }
              
            if ( maxLength )
            
              element
              
                .setAttribute ( 'maxlength', maxLength );
                
            };
            
          elements.forEach ( callback );
          
        };
        
      // initialize twc module
      
      window.twc = ( ( self ) => self ) ( window.twc || { } );
      
      twc.ftfmld = ( ( self ) => {
      
        const options = {
        
          ids : [ ]
          
          };
          
        Object
        
          .assign (
          
            self,
            
            options
            
            );
            
        return self;
        
        } ) ( twc.ftfmld || { } );
        
      // initialize twc fiwoc sub-module
      
      twc.fiwoc = ( ( self ) => self ) ( twc.fiwoc || { } );
      
      // initialize twc fiwoc callbacks sub-module
      
      twc.fiwoc.callbacks = ( ( self ) => {
      
        self.push ( elementCallback );
        
        return self;
        
        } ) ( twc.fiwoc.callbacks || [ ] );
        
      // initialize twc mloc sub-module
      
      twc.mloc = ( ( self ) => self ) ( twc.mloc || { } );
      
      // initialize twc mloc callbacks sub-module
      
      twc.mloc.callbacks = ( ( self ) => {
      
        self.push ( elementCallback );
        
        return self;
        
        } ) ( twc.mloc.callbacks || [ ] );
        
      } ) ( );
      
    </script>
    
  <!-- end TWC Product Custom Form Text Field Max Length -->
